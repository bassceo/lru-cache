# Лабораторная работа №2
## Лукьянчук Ярослав P3323 (367361)
```json
{
  "target_os": "Linux",
  "cache_policy": "Random"
}
```

[Отчёт](./reports/report.md)  <br>
[Отчёт PDF](./reports/report.pdf) 

## Мои результаты

```bash
       _,met$$$$$gg.          debian@debian 
    ,g$$$$$$$$$$$$$$$P.       ------------- 
  ,g$$P"     """Y$$.".        OS: Debian GNU/Linux 12 (bookworm) aarch64 
 ,$$P'              `$$$.     Host: QEMU Virtual Machine virt-7.2 
',$$P       ,ggs.     `$$b:   Kernel: 6.1.0-28-arm64 
`d$$'     ,$P"'   .    $$$    Uptime: 1 hour, 49 mins 
 $$P      d$'     ,    $$P    Packages: 1670 (dpkg) 
 $$:      $$.   -    ,d$$'    Shell: bash 5.2.15 
 $$;      Y$b._   _,d$P'      Resolution: 1800x1126 
 Y$$.    `.`"Y$$$$P"'         DE: GNOME 43.9 
 `$$b      "-.__              WM: Mutter 
  `Y$$                        WM Theme: Adwaita 
   `Y$$.                      Theme: Adwaita [GTK2/3] 
     `$$b.                    Icons: Adwaita [GTK2/3] 
       `Y$$b.                 Terminal: vscode 
          `"Y$b._             CPU: (6) 
              `"""            GPU: 00:02.0 Red Hat, Inc. Virtio 1.0 GPU 
                              Memory: 1750MiB / 3921MiB 

===================================================
              Performance Test Suite                 
===================================================

Test 1: LRU Cache Performance Test
Description: Evaluating cache performance with different
file sizes and access patterns (sequential and random)
===================================================

Size(MB) | Mode  | Run | no_cache(ms) | with_cache(ms)
------------------------------------------------------
256      | seq |  1  | 556.99       | 121.61
256      | seq |  2  | 180.57       | 82.68
256      | seq |  3  | 144.44       | 97.06
256      | rand |  1  | 131.31       | 63.39
256      | rand |  2  | 107.42       | 74.26
256      | rand |  3  | 184.01       | 84.68
512      | seq |  1  | 269.37       | 145.71
512      | seq |  2  | 262.25       | 144.72
512      | seq |  3  | 213.70       | 128.11
512      | rand |  1  | 185.56       | 123.67
512      | rand |  2  | 187.56       | 123.31
512      | rand |  3  | 185.75       | 126.48
1024      | seq |  1  | 620.01       | 1760.32
1024      | seq |  2  | 553.51       | 1338.44
1024      | seq |  3  | 508.06       | 1708.58
1024      | rand |  1  | 377.81       | 1088.60
1024      | rand |  2  | 401.16       | 1119.03
1024      | rand |  3  | 365.50       | 1095.07

===================================================
Test 2: External Integer Sorting Test
Description: Testing the performance of external
merge sort implementation for integer arrays
===================================================
 total_ints | chunk_size |   sys_time(ms)  |  lab2_time(ms)
------------+------------+-----------------+----------------
      20000 |       2000 |           57.36 |           5.99
      50000 |       5000 |          140.39 |          12.77
     100000 |      10000 |          254.05 |          27.84
```

## Анимация

<img src="./reports/animation.gif">


---

# Задание

Для оптимизации работы с блочными устройствами в ОС существует кэш страниц с данными, которыми мы производим операции чтения и записи на диск. Такой кэш позволяет избежать высоких задержек при повторном доступе к данным, так как операция будет выполнена с данными в RAM, а не на диске (вспомним пирамиду памяти).

В данной лабораторной работе необходимо реализовать блочный кэш в пространстве пользователя в виде динамической библиотеки (dll или so). Политику вытеснения страниц и другие элементы задания необходимо получить у преподавателя.

При выполнении работы необходимо реализовать простой API для работы с файлами, предоставляющий пользователю следующие возможности:

1. Открытие файла по заданному пути файла, доступного для чтения. Процедура возвращает некоторый хэндл на файл. Пример:
`int lab2_open(const char *path).`

2. Закрытие файла по хэндлу. Пример:
`int lab2_close(int fd).`

3. Чтение данных из файла. Пример:
`ssize_t lab2_read(int fd, void buf[.count], size_t count).`

4. Запись данных в файл. Пример:
`ssize_t lab2_write(int fd, const void buf[.count], size_t count).`

5. Перестановка позиции указателя на данные файла. Достаточно поддержать только абсолютные координаты. Пример:
​​​​​​​`off_t lab2_lseek(int fd, off_t offset, int whence).`

6. Синхронизация данных из кэша с диском. Пример:
`int lab2_fsync(int fd).`

Операции с диском разработанного блочного кеша должны производиться в обход page cache используемой ОС.

В рамках проверки работоспособности разработанного блочного кэша необходимо адаптировать указанную преподавателем программу-загрузчик из ЛР 1, добавив использование кэша. Запустите программу и убедитесь, что она корректно работает. Сравните производительность до и после.

## Ограничения

- Программа (комплекс программ) должна быть реализован на языке C или C++.

- Запрещено использовать высокоуровневые абстракции над системными вызовами. Необходимо использовать, в случае Unix, процедуры libc.

