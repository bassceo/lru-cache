# Лабораторная работа №2
## Лукьянчук Ярослав P3323 (367361)
```json
{
  "target_os": "Linux",
  "cache_policy": "LRU"
}
```

## Мои результаты в формате таблицы (Debian GNU, Macbook Pro 14 | M1 Pro)

| Size (MB) | Mode | Run | no_cache (ms) | with_cache (ms) |
|-----------|------|-----|---------------|-----------------|
| **256**   | seq  | 1   | 242.43        | 79.83           |
| **256**   | seq  | 2   | 148.46        | 69.19           |
| **256**   | seq  | 3   | 138.19        | 75.81           |
| **256**   | rand | 1   | 162.30        | 113.23          |
| **256**   | rand | 2   | 230.98        | 147.28          |
| **256**   | rand | 3   | 214.45        | 73.28           |
| **512**   | seq  | 1   | 436.02        | 1374.73         |
| **512**   | seq  | 2   | 271.15        | 153.82          |
| **512**   | seq  | 3   | 255.32        | 131.94          |
| **512**   | rand | 1   | 419.13        | 282.22          |
| **512**   | rand | 2   | 341.51        | 137.64          |
| **512**   | rand | 3   | 273.12        | 144.22          |
| **1024**  | seq  | 1   | 842.00        | 3344.85         |
| **1024**  | seq  | 2   | 1786.39       | 3614.39         |
| **1024**  | seq  | 3   | 1494.87       | 4539.89         |
| **1024**  | rand | 1   | 1568.43       | 2759.79         |
| **1024**  | rand | 2   | 965.15        | 2300.67         |
| **1024**  | rand | 3   | 1235.54       | 2756.00         |


<!-- [Отчёт](./reports/REPORT.md)  
[Отчёт PDF](./reports/report.pdf) -->

---

## Задание

В данной лабораторной работе необходимо реализовать блочный кэш в пространстве пользователя в виде динамической библиотеки (**.so**). Политику вытеснения (в данном случае **LRU**) и другие элементы задания определяет преподаватель.

API библиотеки должно предоставлять следующие функции:
- **Открытие файла**: `int lab2_open(const char *path);`
- **Закрытие файла**: `int lab2_close(int fd);`
- **Чтение**: `ssize_t lab2_read(int fd, void *buf, size_t count);`
- **Запись**: `ssize_t lab2_write(int fd, const void *buf, size_t count);`
- **Перестановка позиции**: `off_t lab2_lseek(int fd, off_t offset, int whence);`
- **Синхронизация данных**: `int lab2_fsync(int fd);`

Операции с диском должны производиться с использованием `O_DIRECT`, в обход системного **page cache**. Блоки кэша должны иметь фиксированный размер, кратный размеру страницы (например, 4КБ). Политика вытеснения — **LRU**.

Также необходимо:
1. Взять одну из программ-нагрузчиков, созданных в ЛР №1, и адаптировать её для использования разработанного кэша (вместо обычных системных вызовов чтения/записи).  
2. Сравнить производительность до и после внедрения собственного блочного кэша.  
3. Сделать вывод о влиянии пользовательского кэша на операции чтения и записи.

---

## Ограничения
- Использовать **C** или **C++**.
- При работе с **Unix**-подобными системами применять прямые вызовы libc (без высокоуровневых обёрток).
- Если по варианту задана политика **Optimal**, нужно предоставить дополнительный интерфейс подсказок (но здесь указана **LRU**, поэтому не требуется).
- Необходимо корректно обрабатывать ошибки и особые случаи (например, запись за конец файла).